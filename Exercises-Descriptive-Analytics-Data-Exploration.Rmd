---
title: "R Notebook"
output: html_notebook
---

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code. 

Try executing this chunk by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Ctrl+Shift+Enter*. 

```{r}

#http://r-exercises.com/2016/11/10/descriptive-analytics-part-3-outlier-treatment/
#https://www.r-bloggers.com/descriptive-analytics-part-4-data-manipulation/
#http://r-exercises.com/2016/11/21/descriptive-analytics-part-4-data-manipulation/

flights <- read.csv("2008.csv")

#Print the structure of the data. What do you think about it?
str(flights)

#Print the summary statistics of the data. What do you think about the values? (format, consistency, completeness)
summary(flights)

#Print the dimensionality of the data (number of rows and columns)
dim(flights)

#Print the number of rows. This may seem like a silly command, but it is quite useful for loops and if statements.
nrow(flights)

#Print the number of columns.
ncol(flights)

#Print the names of the variables.
names(flights)

#Print whether the first column has missing values (NAs). Try to answer this question with two ways. Hint: %in%
match(TRUE,is.na(flights[1]),nomatch = FALSE)
#OR
TRUE %in% is.na(flights[1])

#Print the number of variables that contain missing values.
count <- 0
for(i in 1:ncol(flights)){
    if(match(TRUE, is.na(flights[i]), nomatch = FALSE)){
        count <- count+1
    }
}

# OR

count <- 0
for (i in 1:ncol(flights)){
  if( TRUE %in% is.na(flights[i])){
    count <- count+1
  }
}

print(count)

#Find the portion of the variables that contain missing values. What do you think about it?
count/ncol(flights)

#Print the names of the variables that contain missing values.
name <- c()
for (i in 1:length(flights)){
    if(match(TRUE, is.na(flights[i]), nomatch = FALSE)){
        nama <- append(name, names(flights[i]))
    }
}


#Part 1: Data Formatting Exercises


library(stringr)
library(chron)

#Print the first five rows of the dataset.
head(flights[name]) ## The date format makes sense to us , but not to R, if we just proceed to analysis without the data cleansing the result will make no sense or be quite biased.

#Create a new objected named dep_time and assign the values of flights$DepTime . If the value is less than 4 elements, fill make it a 4-element value with zeros. For example, 123 -> 0123.
dep_time <- str_pad(flights$DepTime, 4, pad = "0")

#Create a new object named hour and assign the first two elements of the dep_time object.
hour <- substring(dep_time, 1,2)

#Create a new object named minutes and assign the last two elements of the dep_time object.
minutes <- substring(dep_time, 3, 4)

#Assign to the object dep_time the hour in format ‘HH:MM:SS’ , seconds should be ‘00’ , we make this assumption for the sake of formatting.
for(i in 1:length(dep_time)){
  dep_time[i] <- paste(c(hour[i],minutes[i],'00'),collapse = ':')
}

#Change the class of dep_time from character to times.
dep_time <- chron(times = dep_time)

#Print the first 10 rows and then the 10 last rows of the dep_time. If the formatting of the object is ‘HH:MM:SS’(as it should) then assign the dep_time to flights$DepTime
head(dep_time, n=10)

tail(dep_time, n=10)

flights$DepTime <- dep_time

#Do the exact same process for the flights$DepTime and create the variable arr_time
arr_time <- str_pad(flights$ArrTime, 4, pad = "0")
hour <- substring(arr_time, 1,2)
minutes <- substring(arr_time, 3,4)
for(i in 1:length(arr_time)){
    arr_time[i] <- paste(c(hour[i], minutes[i], '00'), collapse = ':')
}
arr_time <- chron(times = arr_time)

head(arr_time, n =10)
tail(arr_time, n = 10)
flights$ArrTime <- arr_time

#Do the exact same process for the flights$ CRSDepTime and create the variable crs_dep_time
crs_dep_time <- str_pad(flights$CRSDepTime, 4, pad = "0")
hour <- substring(crs_dep_time, 1,2)
minutes <- substring(crs_dep_time, 3,4)
for(i in 1:length(crs_dep_time)){
    crs_dep_time[i] <- paste(c(hour[i], minutes[i], '00'), collapse = ':')
}
crs_dep_time <- chron(times = crs_dep_time)

head(crs_dep_time, n =10)
tail(crs_dep_time, n = 10)
flights$CRSDepTime <- crs_dep_time

#Do the exact same process for the flights$CRSArrTime and create the variable crs_arr_time.
crs_arr_time <- str_pad(flights$CRSArrTime, 4, pad = "0")
hour <- substring(crs_arr_time, 1,2)
minutes <- substring(crs_arr_time, 3,4)
for(i in 1:length(crs_arr_time)){
    crs_arr_time[i] <- paste(c(hour[i], minutes[i], '00'), collapse = ':')
}
crs_arr_time <- chron(times = crs_arr_time)

head(crs_arr_time, n =10)
tail(crs_arr_time, n = 10)
flights$CRSArrTime <- crs_arr_time



#Part 2 : Data Imputation

#For this set of exercises you will need to install and load the package Hmisc.
library(Hmisc)

#Print the summary statistics in order to have an actual idea of the missing values.
summary(flights)

#Impute the missing values of flights$ArrTime with the mean using which.
flights$ArrTime[which(is.na(flights$AirTime))] <- mean(flights$AirTime)

#Impute the missing values of flights$CRSArrTime with the median using which.
flights$CRSArrTime[which(is.na(flights$CRSArrTime))] <- median(flights$CRSArrTime, na.rm = TRUE)

#Impute the missing values of flights$AirTime with the median using the transform operator.
flights <- transform(flights, AirTime = ifelse(is.na(AirTime), mean(AirTime, na.rm = TRUE), AirTime))

#Impute the missing values of flights$DepTime with the median using the transform operator. Note: mind the data formatting .
flights <- transform(flights, DepTime = chron(times = ifelse(is.na(DepTime), mean(DepTime, na.rm = TRUE), DepTime)))

#Impute the missing values of flights$ArrDelay with the median using the impute operator.
flights$ArrDelay <- impute(flights$ArrDelay, mean)

#Impute the missing values of flights$CRSElapsedTime with the median using the impute operator.
flights$CRSElapsedTime <- impute(flights$CRSElapsedTime, median)

#Make a linear regression model named lm_dep_time_delay with target variable flights$DepDelay and independent variables : flights$ArrTime, flights$AirTime, flights$ArrDelay, flights$DepTime.
lm_dep_time_delay <- lm(DepDelay ~ ArrTime+AirTime+ArrDelay+DepTime, data = flights)

#Create an object pred_dep_time_delay and assign the predicted values.
pred_dep_time_delay <- predict(lm_dep_time_delay, flights)

#Impute the missing values based using the pred_dep_time_delay and ifelse function. Print the summary statistics to see the changes that you made.
flights$DepDelay <- ifelse(is.na(flights$DepDelay), pred_dep_time_delay, flights$DepDelay)

summary(flights)



# Part 4 : Data Manipulation


library(dplyr)
library(chron)
library(rapportools)
library(outliers)

flights <- tbl_df(flights)

#Print the destination, the delay of arrivals and the air time of each flight. Hint: use select function
flights%>%
    select(Dest, ArrDelay, AirTime)

#Print the columns that their name contains the word ‘Delay’.
flights%>%
    select(contains('Delay'))

#Print the names of carrier, the month and the day of the week that the delay of carrier is higher than 180.
flights%>%
    filter(CarrierDelay>180) %>%
    select(UniqueCarrier, DayOfWeek, Month)

#Print out all the flights grouped by carrier names.
flights%>%
    group_by(UniqueCarrier)

#Print out the mean of the arrival delay using the summarise function.
flights%>%
    summarise(Mean_ArrDelay = mean(ArrDelay, na.rm = TRUE))

#Print out the minimum,mean,median,variance,standard deviation,maximum,and counts of AirTime.
flights%>%
    summarise(Min = min(AirTime),
              Mean = mean(AirTime),
              Median = median(AirTime),
              Var = var(AirTime),
              Std = sd(AirTime),
              Max = max(AirTime),
              Count = n()
              )

#Print out the mean delay and the number of flights of each carrier.
flights%>%
    group_by(UniqueCarrier)%>%
    summarise(Mean_Delay = mean(ArrDelay),
              Number_of_flights = n()
              )

#Print out the mean delay and the number of flights of each carrier in descending order.
flights%>%
    group_by(UniqueCarrier)%>%
    summarise(Mean_Delay = mean(ArrDelay, na.rm = TRUE),
              Number_of_flights = n()) %>%
    arrange(desc(Mean_Delay)) 

#This exercise is a bit out of context, but it will demonstrate a great way of manipulating data and it is a prerequisite for the next exercise.
#Create a new column code>Full_Date which will contain the date of each flight and then print it out. Hint: Use the mutate function.

flights$Year <- as.character(flights$Year)
flights$Month <- as.character(flights$Month)
flights$DayofMonth <- as.character(flights$DayofMonth)

flights <- flights %>%
    mutate(Full_Date = chron(date = paste(Month, DayofMonth, Year, sep = '/')))

flights %>%
    select(Full_Date)

#Print out the dates that had the most flights and then print out the dates that had the highest ratio of cancelled flights.
flights %>%
    group_by(Full_Date) %>%
    summarise(Number_of_flights = n()) %>%
    arrange(desc(Number_of_flights))

flights %>%
    group_by(Full_Date) %>%
    summarise(Number_of_flights = n(), Ratio_of_Cancelled = sum(Cancelled)/n())%>%
    arrange(desc(Ratio_of_Cancelled)) %>%
    select(Full_Date, Number_of_flights, Ratio_of_Cancelled)


```

Add a new chunk by clicking the *Insert Chunk* button on the toolbar or by pressing *Ctrl+Alt+I*.

When you save the notebook, an HTML file containing the code and output will be saved alongside it (click the *Preview* button or press *Ctrl+Shift+K* to preview the HTML file).
